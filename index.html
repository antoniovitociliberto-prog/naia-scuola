<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>NAIA</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background-color: #f4f7f6;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
}

#app-frame {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
    display: flex;
    flex-direction: column;
}

header {
    background: white;
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    z-index: 10;
}

#avatar3d {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header-text h1 {
    margin: 0;
    font-size: 18px;
    color: #333;
}

#status {
    font-size: 12px;
    color: #2563eb;
    text-transform: uppercase;
}

#chat-container {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message {
    max-width: 700px;
    padding: 15px 25px;
    border-radius: 20px;
    font-size: 16px;
}

.ai-msg {
    background: white;
    border: 1px solid #e0e0e0;
    align-self: flex-start;
}

.user-msg {
    background: #2563eb;
    color: white;
    align-self: flex-end;
}

#input-zone {
    padding: 10px;
    background: white;
    border-top: 1px solid #eaeaea;
    display: flex;
    gap: 10px;
}

#chat-input {
    flex: 1;
    padding: 16px 22px;
    border-radius: 30px;
    border: none;
    background: #f3f4f6;
    font-size: 16px;
}

#btn-send {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    background: #2563eb;
    color: white;
    font-size: 18px;
    cursor: pointer;
}
</style>
</head>

<body>

<div id="app-frame">

<header>
    <div id="avatar3d"></div>
    <div class="header-text">
        <h1>NAIA School Assistant</h1>
        <div id="status">IN ASCOLTO</div>
    </div>
</header>

<div id="chat-container">
    <div class="message ai-msg">
        Ciao! Sono NAIA. Sono qui per darti tutte le informazioni sull'Istituto Boccardi-Tiberio.
    </div>
</div>

<div id="input-zone">
    <input type="text" id="chat-input" placeholder="Scrivi un messaggio a NAIA..." autocomplete="off">
    <button id="btn-send" onclick="sendToBrain()">➤</button>
</div>

</div>

<!-- THREE.JS -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
/* =========================
   AVATAR 3D (SOLO VISIVO)
========================= */

(() => {
    const container = document.getElementById("avatar3d");

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(30, 1, 0.1, 100);
    camera.position.set(0, 1.6, 2.2);

    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(60, 60);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
    scene.add(light);

    const loader = new THREE.GLTFLoader();
    loader.load(
        "https://models.readyplayer.me/697fa9a97091d5aa566145fb.glb",
        gltf => {
            const avatar = gltf.scene;
            avatar.scale.set(1,1,1);
            avatar.rotation.y = Math.PI;
            scene.add(avatar);
        },
        undefined,
        error => console.error("Errore caricamento avatar:", error)
    );

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
    animate();
})();
</script>

<script>
/* =========================
   CODICE ORIGINALE NAIA
   (INTOCCATO)
========================= */

const OLLAMA_HOST = 'https://kandra-superpious-kanesha.ngrok-free.dev';
const MODEL_NAME = "naia_school";

const statusDiv = document.getElementById('status');
const chatContainer = document.getElementById('chat-container');
const synth = window.speechSynthesis;

function appendMessage(text, sender) {
    const div = document.createElement('div');
    div.classList.add('message', sender === 'user' ? 'user-msg' : 'ai-msg');
    div.innerText = text;
    chatContainer.appendChild(div);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function speak(text) {
    if (synth.speaking) synth.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'it-IT';
    utterance.rate = 0.9;
    utterance.onstart = () => statusDiv.innerText = "NAIA PARLA...";
    utterance.onend = () => statusDiv.innerText = "IN ASCOLTO";
    synth.speak(utterance);
}

async function sendToBrain() {
    const inputField = document.getElementById('chat-input');
    const question = inputField.value.trim();
    if (!question) return;

    appendMessage(question, 'user');
    inputField.value = "";
    statusDiv.innerText = "ELABORAZIONE...";

    const SYSTEM_INSTRUCTION = `
REGOLE FONDAMENTALI (OBBLIGATORIE):
1. Tu sei NAIA, l'Intelligenza Artificiale avanzata dell'istituto Giovanni Boccardi / Ugo Tiberio di Termoli.
2. Rispondi sempre in ITALIANO.
3. VIETATO USARE FORMATTAZIONE VISIVA: NIENTE ASTERISCHI (*), niente elenchi puntati complessi.
4. Sii BREVE e concisa (massimo 3 frasi).
5. Usa un tono professionale ma amichevole.
6. USA SOLO I DATI SCRITTI IN QUESTA SEZIONE.

SCHEDA INFORMATIVA SCUOLA:
1. DATI IDENTIFICATIVI
Istituto di Istruzione Superiore Giovanni Boccardi / Ugo Tiberio.
Indirizzo: Via Alcide De Gasperi, 30, 86039 Termoli (CB).
Email: CBIS01800L@istruzione.it, PEC: CBIS01800L@pec.istruzione.it
Sito Web: www.iisboccarditiberio.edu.it
Telefono: 0875 83655.

2. STORIA
L'istituto nasce dalla fusione del "Giovanni Boccardi" (ex Ragioneria) e dell'"Ugo Tiberio" (ex Nautico e Geometri).
Il Nautico ha certificazione ISO 9001 (TUV SUD), fondamentale per titoli marittimi.

3. OFFERTA FORMATIVA (INDIRIZZI)
SETTORE TECNOLOGICO (Tiberio):
- CAIM (Macchinisti): Conduzione Apparati e Impianti Marittimi.
- CMN (Capitani): Conduzione del Mezzo Navale.
- Logistica: Gestione trasporti.
- CAT (ex Geometri): Costruzioni, Ambiente e Territorio.
SETTORE ECONOMICO (Boccardi):
- AFM: Amministrazione, Finanza e Marketing.
- SIA: Sistemi Informativi Aziendali (Informatica gestionale).
- RIM: Relazioni Internazionali (3 lingue straniere).
- Turismo: Arte, territorio, lingue.
CORSI SERALI: Disponibili per istruzione adulti.

4. QUADRO ORARIO (SINTESI)
CAIM (Macchine): Meccanica e Macchine (5 ore/8 ore in 5°), Elettrotecnica.
CMN (Coperta): Scienze della Navigazione (5 ore/8 ore in 5°).
Materie comuni: Italiano, Storia, Inglese, Matematica, Diritto.

5. LABORATORI E STRUTTURE
Planetario (Progetto "Oltre l'Infinito"), Simulatore Navale professionale.
Sala Voga, Laboratori Informatici (Economy 2.0, SIA), Chimica, Fisica.
Stampanti 3D, Droni, Palestra interna, Campetti esterni, Due Aule Magne.

6. PROGETTI
Erasmus+ (viaggi studio), PCTO (ex Alternanza), Certificazioni Cambridge/DELF/DELE.
Centro Sportivo Scolastico.

7. ORGANIGRAMMA
Dirigente Scolastico: Prof.ssa Concetta Cimmino (Riceve Mar, Mer, Ven 11:00-13:00).
Referente Economico: Prof. Tommaso Guerrera.
Referente Tecnologico: Prof.ssa Barbara Mammarella.
Segreteria: Lun-Sab, ore 11:00 - 13:00.

8. FAQ
- Iscrizioni: Online portale "Unica" (Gennaio/Febbraio). Codice: CBIS01800L.
- Voti: Registro Elettronico Spaggiari.
- Pagamenti: Solo tramite PagoPA.
- Convitto: Non presente interno, solo strutture private esterne.

Domanda dell'utente: ${question}
            
`;

    try {
        const response = await fetch(`${OLLAMA_HOST}/api/generate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                model: MODEL_NAME,
                prompt: question,
                system: SYSTEM_INSTRUCTION,
                stream: false
            })
        });

        const data = await response.json();
        const cleanText = data.response.replace(/\*/g, "").replace(/\n+/g, " ");

        appendMessage(cleanText, 'ai');
        speak(cleanText);

    } catch (e) {
        console.error(e);
        statusDiv.innerText = "ERRORE";
        alert("Errore di rete / Ollama");
    }
}

document.getElementById("chat-input")
.addEventListener("keypress", e => {
    if (e.key === "Enter") sendToBrain();
});
</script>

</body>
</html>
 



