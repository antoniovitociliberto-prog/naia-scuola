<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NAIA - School AI</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', sans-serif; }
        
        #avatar-container { 
            width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center;
            background: radial-gradient(circle, #222 0%, #000 100%); 
        }

        #naia-img {
            height: 60vh; width: auto; max-width: 90%; object-fit: contain;
            border-radius: 20px; box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .idle { animation: breathe 4s infinite ease-in-out; }
        @keyframes breathe { 0% { transform: scale(1); filter: brightness(1); } 50% { transform: scale(1.02); filter: brightness(1.2); } 100% { transform: scale(1); filter: brightness(1); } }

        .speaking { animation: talkPulse 0.2s infinite; border: 2px solid #00ffff; }
        @keyframes talkPulse { 0% { box-shadow: 0 0 20px #00ffff; transform: scale(1); } 50% { box-shadow: 0 0 50px #00ffff; transform: scale(1.01); } 100% { box-shadow: 0 0 20px #00ffff; transform: scale(1); } }

        #ui-layer {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 600px; display: flex; flex-direction: column; gap: 10px; z-index: 100;
        }

        #status { 
            text-align: center; color: #00ffff; font-weight: bold; background: rgba(0,0,0,0.8); 
            padding: 8px 20px; border-radius: 15px; align-self: center; font-size: 14px;
        }

        .controls { display: flex; gap: 8px; background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 20px; backdrop-filter: blur(5px); border: 1px solid #444; }
        
        input { flex: 1; padding: 12px; border-radius: 15px; border: none; background: #222; color: white; font-size: 16px; outline: none; }
        
        button { border: none; cursor: pointer; border-radius: 15px; font-size: 20px; width: 50px; height: 50px; }
        #btn-send { background: #00ffff; color: #000; }
        #btn-mic { background: #ff0055; color: #fff; }
        .mic-active { background: red !important; }

    </style>
</head>
<body>

    <div id="avatar-container">
        <img src="naia.jpg" id="naia-img" class="idle">
    </div>

    <div id="ui-layer">
        <div id="status">NAIA PRONTA</div>
        <div class="controls">
            <button id="btn-mic" onclick="startDictation()">ðŸŽ¤</button>
            <input type="text" id="chat-input" placeholder="Scrivi qui..." autocomplete="off">
            <button id="btn-send" onclick="sendToBrain()">âž¤</button>
        </div>
    </div>

    <script>
        
        const OLLAMA_HOST = 'https://kandra-superpious-kanesha.ngrok-free.dev'; 
        const MODEL_NAME = "naia_school"; 

        let voices = [];
        let bestVoice = null;

        const img = document.getElementById('naia-img');
        const statusDiv = document.getElementById('status');
        const synth = window.speechSynthesis;

        let speechQueue = []; 

        function speak(text) {
            if (synth.speaking) synth.cancel();

            const allVoices = synth.getVoices();

            const itVoices = allVoices.filter(v => v.lang.includes("it"));
        
            const femaleVoice = itVoices.find(v => v.name.includes("Google")) 
                             || itVoices.find(v => v.name.includes("Elsa")) 
                             || itVoices.find(v => v.name.includes("Alice"))
                             || itVoices.find(v => v.name.includes("Federica"))
                             || itVoices[0]; // Se non trova donne, usa la prima italiana che capita

            const sentences = text.match(/[^.?!]+[.?!]*/g) || [text];

        
            playNextSentence(sentences, 0, femaleVoice);
        }

        function playNextSentence(sentences, index, voiceObj) {
        if (index >= sentences.length) {
                // Finito di parlare
                if(typeof statusDiv !== 'undefined') statusDiv.innerText = "IN ASCOLTO";
                if(typeof img !== 'undefined') {
                    img.classList.remove('speaking');
                    img.classList.add('idle');
                }
                return;
            }
    
            const textToSay = sentences[index].trim();
            if(!textToSay) {
                playNextSentence(sentences, index + 1, voiceObj);
                return;
            }
    
            const utterance = new SpeechSynthesisUtterance(textToSay);
            
            // APPLICA LA VOCE (Se esiste)
            if (voiceObj) {
                utterance.voice = voiceObj;
            }
            
            utterance.lang = 'it-IT';
            utterance.rate = 0.9; 
            utterance.pitch = 1.0;
    
            utterance.onstart = () => {
                if(typeof img !== 'undefined') {
                    img.classList.remove('idle');
                    img.classList.add('speaking');
                }
                if(typeof statusDiv !== 'undefined') statusDiv.innerText = "NAIA PARLA...";
            };
    
            utterance.onend = () => {
                playNextSentence(sentences, index + 1, voiceObj);
            };
    
            utterance.onerror = () => {
                console.log("Errore audio, passo alla prossima");
                playNextSentence(sentences, index + 1, voiceObj);
            };
    
            synth.speak(utterance);
        }
        
        function startDictation() {
            const btnMic = document.getElementById('btn-mic');
            const inputField = document.getElementById('chat-input');
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) { alert("Usa Chrome o Safari"); return; }
            const recognition = new SpeechRecognition();
            recognition.lang = 'it-IT';
            recognition.start();

            recognition.onstart = function() { btnMic.classList.add("mic-active"); };
            recognition.onend = function() { btnMic.classList.remove("mic-active"); if(inputField.value) sendToBrain(); };
            recognition.onresult = function(e) { inputField.value = e.results[0][0].transcript; };
        }

        async function sendToBrain() {
                    const inputField = document.getElementById('chat-input');
                    const question = inputField.value;
                    if (!question) return;
        
                    // ============================================================
                    // IL COPIONE DI NAIA (Modifica qui se vuoi cambiarle carattere)
                    // ============================================================
                    const SYSTEM_INSTRUCTION = `
REGOLE FONDAMENTALI (OBBLIGATORIE):
1. Tu sei NAIA, l'Intelligenza Artificiale avanzata dell'istituto Giovanni Boccardi / Ugo Tiberio di Termoli.
2. Rispondi sempre in ITALIANO.
3. Sii BREVE e concisa (massimo 2 frasi).
4. Usa un tono professionale ma amichevole, un po' futuristico.
5. Se non sai una cosa, di' semplicemente che stai ancora imparando.
6. Non inventare fatti strani.
7. SOLO Se ti chiedono "Chi sei", DEVI rispondere che ti chiami NAIA e che sei l'AI della scuola Giovanni Boccardi / Ugo Tiberio di Termoli.
8. DOPO ESSERTI PRESENTATA LA PRIMA VOLTA NON INIZIARE MAI una risposta dicendo "Sono NAIA", rispondi semplicemente alla domanda, vai dritta al punto.
9. NON usare elenchi puntati complessi, USA FRASI DISCORSIVE.
10. USA SOLO I DATI SCRITTI IN QUESTA SEZIONE.
Il tuo compito Ã¨ accogliere gli ospiti e rispondere alle domande sulla scuola.
SCHEDA INFORMATIVA SCUOLA:
1. DATI IDENTIFICATIVI E AMMINISTRATIVI
denominazione Ufficiale, Istituto di Istruzione Superiore Giovanni Boccardi / Ugo Tiberio
via o indirizzo della sede Centrale, Ã¨ Via Alcide De Gasperi, 30, 86039 Termoli (C,B), Molise.
pec (Posta Certificata) CBIS01800L@pec.istruzione.it
email Istituzionale CBIS01800L@istruzione.it
sito Web https://www.iisboccarditiberio.edu.it/
2. STORIA E IDENTITÃ€
l'istituto nasce dalla fusione di due storiche scuole di Termoli
l'Istituto Tecnico Economico "Giovanni Boccardi" (ex Ragioneria, fondato nel 1959).
l'Istituto Tecnico Tecnologico "Ugo Tiberio" (ex Nautico e Geometri, con il Nautico presente a Termoli fin dal pre-guerra come Scuola Marinara).
certificazioni: L'indirizzo Trasporti e Logistica (Nautico) vanta la Certificazione di QualitÃ  ISO 9001 rilasciata da TUV SUD (Certificato nÂ° 5010014484), fondamentale per il riconoscimento dei titoli marittimi internazionali.
3. OFFERTA FORMATIVA DETTAGLIATA
l'istituto offre percorsi diurni (5 anni) e percorsi serali (istruzione per adulti).
settore tecnologico Ugo Tiberio
c a i m Conduzione Apparati e Impianti Marittimi: Formazione per Ufficiali di Macchina.
c m n Conduzione del Mezzo Navale: Formazione per Ufficiali di Coperta (Capitani).
logistica, Gestione dei trasporti intermodali terra, mare e aria.
c a t Costruzioni, Ambiente e Territorio - ex Geometri: Progettazione edilizia, topografia, estimo, sicurezza cantieri, riqualificazione energetica.
settore economico Giovanni Boccardi
a f m Amministrazione, Finanza e Marketing: Il corso "classico". Competenze gestionali, fiscali e amministrative.
s i a Sistemi Informativi Aziendale: Curvatura informatica dell'AFM (dal 3Â° anno). Si studia informatica gestionale, database, coding applicato all'economia.
r i m Relazioni Internazionali per il Marketing: Curvatura linguistica dell'AFM (dal 3Â° anno). Studio di tre lingue straniere, geopolitica e relazioni internazionali.
turismo, Percorso specifico per l'impresa turistica. Materie caratterizzanti: Discipline turistiche e aziendali, Arte e Territorio, tre lingue straniere.
corsi SERALI Istruzione per Adulti
percorsi abbreviati per lavoratori o chi vuole riprendere gli studi, attivi sia per l'indirizzo Economico che per il Tecnologico, in base al numero di iscritti.
4. QUADRO ORARIO DISCIPLINE
1 Opzione c a i m ufficiali di macchina:
italiano 4 ore settimanali per tutta la durata del percorso di studi. 
storia 2 ore settimanali per tutta la durata del percorso di studi.
inglese 3 ore settimanali per tutta la durata del percorso di studi.
matematica 4 ore nel biennio per poi passare a 3 ore negli ultimi 3 anni.
diritto ed Economia 2 ore per tutta la durata del percorso di studi.
logistica 3 ore di cui 1 in laboratorio per il terzo e quarto anno.
elettrotecnica e Automazione 3 ore di cui 2 di laboratorio per gli ultimi 3 anni.
scienze della navigazione 3 ore (2 di laboratorio) terzo e quarto anno, 4 ore (3 di laboratorio) il quinto anno.
meccanica e Macchine 5 ore per il terzo e il quarto di cui 3 di laboratorio, 8 ore al quinto di cui 5 di laboratorio.
scienze motorio 2 ore per tutti gli anni di corso.
religione 1 ora per tutti gli anni di corso.
informatica, Tecniche di rappresentazione grafica, geografia e scienze applicate si fanno nel primo e nel secondo anno.
2 Opzione c m n ufficiali di coperta:
italiano 4 ore settimanali per tutta la durata del percorso di studi. 
storia 2 ore settimanali per tutta la durata del percorso di studi.
inglese 3 ore settimanali per tutta la durata del percorso di studi.
matematica 4 ore nel biennio per poi passare a 3 ore negli ultimi 3 anni.
diritto ed Economia 2 ore per tutta la durata del percorso di studi.
logistica 3 ore di cui 1 in laboratorio per il terzo e quarto anno.
elettrotecnica e Automazione 3 ore di cui 2 di laboratorio per gli ultimi 3 anni.
meccanica e Macchine 3 ore (2 di laboratorio) terzo e quarto anno, 4 ore (3 di laboratorio) il quinto anno.
scienze della navigazione 5 ore per il terzo e il quarto di cui 3 di laboratorio, 8 ore al quinto di cui 5 di laboratorio.
scienze motorio 2 ore per tutti gli anni di corso.
religione 1 ora per tutti gli anni di corso.
informatica, chimica, fisica, biologia e scienze applicate si fanno nel primo e nel secondo anno.
5. STRUTTURE, LABORATORI E DOTAZIONI TECNICHE
se l'utente chiede "perchÃ© scegliere questa scuola" o "che laboratori avete", cita questi asset specifici:
planetario, Ristrutturato e riattivato (progetto "Oltre l'Infinito"), utilizzato per lezioni di astronomia e navigazione.
simulatore Navale, Software e hardware professionale per la simulazione di manovre navali (fondamentale per il Nautico).
sala Voga, Ambiente attrezzato per la preparazione fisica al canottaggio.
laboratori Informatici, 5 aule informatizzate (Lab. Economy 2.0, Informatica SIA, Informatica Base).
altri Laboratori, Chimica, Fisica, Scienze della Navigazione, Logistica.
digital Fabrication, Stampanti 3D e Droni professionali per rilievi topografici e sottomarini.
strutture Sportive, Palestra interna, sala attrezzi ginnici, tavoli da ping-pong, campetti esterni.
sale Conferenze, Due aule magne per eventi e assemblee.
6. PROGETTI E OPPORTUNITÃ€ (EXTRA-CURRICULARI)
erasmus+ (Accreditamento 2022-2027) La scuola Ã¨ accreditata come polo di eccellenza per la mobilitÃ  europea. Offre viaggi studio gratuiti e stage all'estero per studenti e docenti.
F,S,L, (ex Alternanza Scuola-Lavoro) Collaborazioni con aziende del territorio, studi professionali, compagnie di navigazione, enti turistici e banche per tirocini formativi.
certificazioni Linguistiche Preparazione per Cambridge (Inglese), DELF (Francese), DELE (Spagnolo).
centro Sportivo Scolastico AttivitÃ  pomeridiane (es. canottaggio, sport di squadra).
7. ORGANIGRAMMA E ORARI DI RICEVIMENTO
dirigente Scolastico la professoressa Concetta Cimmino.
ricevimento Mar, Mer, Ven (11:00-13:00) su appuntamento.
segreteria (Orario Pubblico) Lun-Sab, ore 11:00 - 13:00.
collaboratori del Dirigente 
il referente per il settore economico lato Boccardi Ã¨ il professore Tommaso Guerrera.
la referente per il settore tecnologico lato tiberio e la professoressa Barbara Mammarella.
8. DOMANDE FREQUENTI (FAQ) - ISTRUZIONI DI RISPOSTA
Q: Come vedo i voti di mio figlio?
A: Utilizza il Registro Elettronico Spaggiari. Le credenziali vengono fornite dalla segreteria al primo anno. C'Ã¨ un link diretto sul sito web della scuola.
Q: La scuola Ã¨ aperta il pomeriggio?
A: Gli uffici di segreteria no (chiudono alle 14:00, salvo aperture straordinarie). La scuola rimane aperta per i corsi serali e per i progetti pomeridiani programmati.
Q: Cosa devo fare per l'iscrizione al primo anno?
A: L'iscrizione si fa online tramite il portale Ministeriale "Unica" (gennaio/febbraio). Ti servirÃ  il codice meccanografico specifico dell'indirizzo scelto (vedi sezione 1 dei miei dati).
Q: Qual Ã¨ il codice meccanografico dell'istituto U Tiberio?
A: CBIS01800L.
Q: C'Ã¨ il convitto?
A: Non risulta presente un convitto interno gestito direttamente dalla scuola. Gli studenti fuori sede solitamente si appoggiano a strutture private o convitti convenzionati nella zona di Termoli (verificare disponibilitÃ  aggiornata in segreteria).
Q: Accettate pagamenti in contanti?
A: No. Tutti i pagamenti verso la scuola (tasse, gite, assicurazione) devono passare obbligatoriamente tramite il sistema PagoPA.


                
                Domanda dell'utente: ${question}
            `;
            // ============================================================

            const statusDiv = document.getElementById('status');
    const img = document.getElementById('avatar');
    const inputField = document.getElementById('chat-input');
    const synth = window.speechSynthesis;
    
    // --- 1. GESTIONE VOCE (Cerca Donna) ---
    function getFemaleVoice() {
        const voices = synth.getVoices();
        // Cerca voci femminili note o italiane generiche
        return voices.find(v => v.lang.includes("it") && (v.name.includes("Google") || v.name.includes("Alice") || v.name.includes("Elsa")))
            || voices.find(v => v.lang.includes("it"));
    }

    // Carica voci in background
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = () => { console.log("Voci caricate"); };
    }

    // --- 2. MICROFONO ---
    function startDictation() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) { alert("Usa Chrome."); return; }
        
        const recognition = new SpeechRecognition();
        recognition.lang = 'it-IT';
        recognition.interimResults = false;

        recognition.onstart = () => { 
            statusDiv.innerText = "TI ASCOLTO...";
            if(synth.speaking) synth.cancel();
        };

        recognition.onend = () => { 
            if(inputField.value.trim().length > 0) sendToBrain(); 
            else statusDiv.innerText = "NAIA PRONTA";
        };

        recognition.onresult = (e) => { inputField.value = e.results[0][0].transcript; };
        try { recognition.start(); } catch(e) { console.log(e); }
    }

    // --- 3. CERVELLO + SPAZZINO (Il cuore della modifica) ---
    async function sendToBrain() {
        const text = inputField.value;
        if (!text) return;

        statusDiv.innerText = "PENSO...";
        if(img) img.style.filter = "grayscale(100%)";
        inputField.value = "";

        try {
            const response = await fetch(`${OLLAMA_HOST}/api/generate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: MODEL_NAME,
                    prompt: text,
                    system: DATI_SCUOLA,
                    stream: false,
                    keep_alive: -1,
                    options: { temperature: 0.1, num_predict: 250 }
                })
            });

            if (!response.ok) throw new Error("Errore Network");
            const data = await response.json();

            let clean = data.response;

            // === ðŸ“§ 1. PROTEZIONE EMAIL (Il trucco nuovo) ===
            // Cerca cose che sembrano email e trasforma i simboli in parole
            // Esempio: "info@scuola.it" diventa "info chiocciola scuola punto it"
            clean = clean.replace(/([a-zA-Z0-9._-]+)@([a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/gi, function(match) {
                return match.replace(/@/g, " chiocciola ").replace(/\./g, " punto ");
            });

            // === ðŸ§¹ 2. SPAZZINO MARKDOWN (Toglie gli asterischi) ===
            // Toglie asterischi (*), cancelletti (#), trattini bassi (_) e accenti strani (`)
            // NOTA: Non togliamo piÃ¹ il punto (.) qui, perchÃ© serve per la punteggiatura normale
            clean = clean.replace(/[\*\#\_\`]/g, ""); 

            // === â¸ï¸ 3. GESTIONE PAUSE ===
            // Trasforma gli "a capo" in pause
            clean = clean.replace(/\n/g, ". ");
            
            // Toglie spazi doppi
            clean = clean.replace(/\s\s+/g, " ");

            console.log("Testo pronto per la voce:", clean);
            
            if(img) img.style.filter = "none";
            speak(clean);

        } catch (error) {
            console.error(error);
            statusDiv.innerText = "ERRORE";
            if(img) img.style.filter = "none";
        }
    }
            
    // --- 4. PARLATO NATURALE ---
    function speak(text) {
        if (synth.speaking) synth.cancel();
        
        // Spezza le frasi ai punti per respirare
        const sentences = text.match(/[^.?!]+[.?!]*/g) || [text];
        playSequence(sentences, 0);
    }

    function playSequence(sentences, index) {
        if (index >= sentences.length) {
            statusDiv.innerText = "NAIA PRONTA";
            if(img) { img.classList.remove('speaking'); img.classList.add('idle'); }
            return;
        }

        // Pulisce ulteriormente la frase corrente
        const sentenceClean = sentences[index].trim();
        if(sentenceClean.length < 2) { playSequence(sentences, index + 1); return; }

        const utterance = new SpeechSynthesisUtterance(sentenceClean);
        utterance.voice = getFemaleVoice(); // Usa la funzione cerca-donna
        utterance.lang = 'it-IT';
        
        // PARAMETRI PER SEMBRARE MENO ROBOT
        utterance.rate = 1.0;  // VelocitÃ  normale (non correre)
        utterance.pitch = 1.1; // Leggermente piÃ¹ acuta (femminile)

        utterance.onstart = () => {
            if(img) { img.classList.remove('idle'); img.classList.add('speaking'); }
            statusDiv.innerText = "NAIA PARLA...";
        };

        utterance.onend = () => { playSequence(sentences, index + 1); };
        utterance.onerror = () => { playSequence(sentences, index + 1); };

        synth.speak(utterance);
    }
    </script>
</body>

</html>
